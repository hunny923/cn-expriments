#include <stdio.h>

#define FLAG 0x7E
#define ESC  0x7D

int main() {
    unsigned char data[] = {0x45, 0x7D, 0x21, 0x7E, 0x33};
    int i, j = 0, k = 0;
    unsigned char stuffed[100], unstuffed[100];

    // Stuffing
    stuffed[j++] = FLAG;
    for (i = 0; i < 5; i++) {
        if (data[i] == FLAG || data[i] == ESC)
            stuffed[j++] = ESC;
        stuffed[j++] = data[i];
    }
    stuffed[j++] = FLAG;

    // Unstuffing
    for (i = 1; i < j - 1; i++) {
        if (stuffed[i] == ESC)
            i++; // Skip ESC
        unstuffed[k++] = stuffed[i];
    }

    // Output
    printf("Original  : ");
    for (i = 0; i < 5; i++) printf("0x%X ", data[i]);

    printf("\nStuffed   : ");
    for (i = 0; i < j; i++) printf("0x%X ", stuffed[i]);

    printf("\nUnstuffed : ");
    for (i = 0; i < k; i++) printf("0x%X ", unstuffed[i]);

    return 0;
}
